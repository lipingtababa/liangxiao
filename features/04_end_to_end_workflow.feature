# language: zh-CN
功能: 端到端工作流程
  作为一个内容运营人员
  我希望能够完成从微信文章到发布的完整流程
  以便高效地管理内容发布

  背景:
    假设 系统所有组件都已正确配置
    并且 我有管理员权限

  @e2e @critical
  场景: 完整的文章发布流程
    假设 我有一个新的微信文章URL "https://mp.weixin.qq.com/s/new-article"
    当 我执行以下步骤:
      | 步骤 | 操作                          | 预期结果                    |
      | 1    | 输入微信文章URL              | URL被系统接受               |
      | 2    | 点击"提取内容"按钮           | 显示提取进度                |
      | 3    | 等待内容提取完成             | 显示提取的内容预览          |
      | 4    | 确认内容正确                 | 可以编辑或修正内容          |
      | 5    | 点击"翻译"按钮              | 显示翻译进度                |
      | 6    | 查看翻译结果                 | 显示中英文对照              |
      | 7    | 编辑翻译内容（如需要）       | 可以修改翻译文本            |
      | 8    | 点击"发布"按钮              | 生成Markdown文件            |
      | 9    | 确认发布                     | 文章出现在网站上            |
    那么 文章应该成功发布到magong.se
    并且 文章应该可以通过URL访问
    并且 所有图片应该正常显示

  场景: 批量处理多篇文章
    假设 我有3篇微信文章需要处理
    当 我提供文章URL列表:
      """
      https://mp.weixin.qq.com/s/article-1
      https://mp.weixin.qq.com/s/article-2
      https://mp.weixin.qq.com/s/article-3
      """
    那么 系统应该批量处理所有文章
    并且 应该显示处理进度 "正在处理第 X 篇，共 3 篇"
    并且 每篇文章应该独立处理
    并且 如果某篇失败不应该影响其他文章

  场景: 处理已发布文章的更新
    假设 文章 "2024-01-01-example.md" 已经发布
    当 原文有更新需要重新翻译
    那么 我应该能够:
      | 操作                  | 结果                        |
      | 重新提取最新内容      | 获取更新后的内容            |
      | 对比新旧版本          | 显示差异                    |
      | 选择性更新翻译        | 只翻译改变的部分            |
      | 更新发布              | 保留原URL，更新内容         |
    并且 应该在文章中标注"最后更新时间"

  @monitoring
  场景: 监控和日志
    当 我执行任何操作
    那么 系统应该记录:
      | 日志类型      | 内容                    |
      | 操作日志      | 用户操作和时间戳        |
      | 错误日志      | 失败的操作和错误信息    |
      | 性能日志      | 处理时间和资源使用      |
      | 审计日志      | 文章发布和修改历史      |
    并且 我应该能够查看操作历史

  @error-recovery
  场景: 错误恢复机制
    假设 在处理过程中发生错误
    当 错误类型为:
      | 错误类型          | 恢复策略                |
      | 网络超时          | 自动重试3次             |
      | API限流           | 延迟后重试              |
      | 翻译失败          | 保存草稿，允许手动修正  |
      | 发布失败          | 回滚并显示错误信息      |
    那么 系统应该按照对应策略处理
    并且 应该保存处理状态以便恢复